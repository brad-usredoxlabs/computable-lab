# UI Specification Schema v1.0
# Defines the structure for UI hints in computable-lab

$schema: "https://json-schema.org/draft/2020-12/schema"
$id: "https://computable-lab.com/schema/ui/ui-v1.schema.yaml"
title: "UI Specification v1"
description: "Schema for *.ui.yaml files - portable rendering hints"
type: "object"

required:
- uiVersion
- schemaId

properties:
  # Version specification
  uiVersion:
    type: "integer"
    enum: [ 1 ]
    description: "UI specification version"

  # Associated schema
  schemaId:
    type: "string"
    format: "uri"
    description: "Schema this UI spec applies to"

  # Display settings for the record type
  display:
    type: "object"
    description: "Display settings for record summaries"
    properties:
      titleField:
        type: "string"
        description: "JSONPath to field used as display title"
      subtitleField:
        type: "string"
        description: "JSONPath to field used as subtitle"
      icon:
        type: "string"
        description: "Icon identifier for this record type"
      color:
        type: "string"
        description: "Color theme for this record type"

  # Form configuration
  form:
    type: "object"
    description: "Form rendering configuration"
    properties:
      layout:
        type: "string"
        enum: [ "vertical", "horizontal", "sections", "tabs" ]
        default: "vertical"
        description: "Overall form layout"

      sections:
        type: "array"
        description: "Form sections"
        items:
          $ref: "#/definitions/section"

  # List view configuration
  list:
    type: "object"
    description: "List view configuration"
    properties:
      columns:
        type: "array"
        description: "Columns to display in list view"
        items:
          $ref: "#/definitions/column"

      defaultSort:
        type: "object"
        properties:
          field:
            type: "string"
          direction:
            type: "string"
            enum: [ "asc", "desc" ]

  # Detail view configuration
  detail:
    type: "object"
    description: "Detail view configuration"
    properties:
      sections:
        type: "array"
        description: "Sections to display in detail view"
        items:
          $ref: "#/definitions/section"

definitions:
  # Section definition
  section:
    type: "object"
    required:
    - fields
    properties:
      title:
        type: "string"
        description: "Section title"
      description:
        type: "string"
        description: "Section description"
      collapsible:
        type: "boolean"
        default: false
        description: "Whether section can be collapsed"
      collapsed:
        type: "boolean"
        default: false
        description: "Whether section starts collapsed"
      fields:
        type: "array"
        description: "Fields in this section"
        items:
          $ref: "#/definitions/field"

  # Field definition
  field:
    type: "object"
    required:
    - path
    properties:
      path:
        type: "string"
        description: "JSONPath to the field in the record"
      label:
        type: "string"
        description: "Display label (defaults to field name)"
      widget:
        type: "string"
        enum:
        - "text"
        - "textarea"
        - "number"
        - "select"
        - "multiselect"
        - "checkbox"
        - "date"
        - "datetime"
        - "ref"
        - "array"
        - "object"
        - "markdown"
        - "code"
        - "hidden"
        default: "text"
        description: "Widget type for rendering"
      required:
        type: "boolean"
        default: false
        description: "Whether field is required (visual hint only)"
      readonly:
        type: "boolean"
        default: false
        description: "Whether field is read-only"
      hidden:
        type: "boolean"
        default: false
        description: "Whether field is hidden"
      placeholder:
        type: "string"
        description: "Placeholder text"
      helpText:
        type: "string"
        description: "Help text shown below field"
      width:
        type: "string"
        enum: [ "full", "half", "third", "quarter" ]
        default: "full"
        description: "Field width in form layout"

      # Widget-specific options
      options:
        type: "object"
        description: "Widget-specific options"
        properties:
          # For select/multiselect
          choices:
            type: "array"
            items:
              type: "object"
              properties:
                value:
                  description: "Option value"
                label:
                  type: "string"
                  description: "Display label"

          # For ref widget
          refSchema:
            type: "string"
            format: "uri"
            description: "Schema of referenced record type"

          # For array widget
          itemWidget:
            type: "string"
            description: "Widget for array items"
          minItems:
            type: "integer"
            description: "Minimum number of items"
          maxItems:
            type: "integer"
            description: "Maximum number of items"

          # For textarea/markdown
          rows:
            type: "integer"
            default: 3
            description: "Number of visible rows"

          # For code widget
          language:
            type: "string"
            description: "Code language for syntax highlighting"

  # Column definition for list views
  column:
    type: "object"
    required:
    - path
    properties:
      path:
        type: "string"
        description: "JSONPath to the field"
      label:
        type: "string"
        description: "Column header"
      width:
        type: "string"
        description: "Column width (e.g., '100px', '20%')"
      sortable:
        type: "boolean"
        default: true
        description: "Whether column is sortable"
      format:
        type: "string"
        enum: [ "text", "date", "number", "boolean", "ref" ]
        default: "text"
        description: "Display format"

additionalProperties: false

# Example
examples:
- title: "Basic UI Spec"
  value:
    uiVersion: 1
    schemaId: "https://computable-lab.com/schema/studies/study.schema.yaml"
    display:
      titleField: "$.title"
      subtitleField: "$.shortSlug"
      icon: "study"
    form:
      layout: "sections"
      sections:
      - title: "Basic Information"
        fields:
        - path: "$.recordId"
          widget: "text"
          readonly: true
        - path: "$.title"
          widget: "text"
          required: true
        - path: "$.description"
          widget: "markdown"
