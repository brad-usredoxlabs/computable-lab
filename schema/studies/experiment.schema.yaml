$schema: "https://json-schema.org/draft/2020-12/schema"
$id: "https://computable-lab.com/schema/computable-lab/experiment.schema.yaml"
title: "Experiment"
description: >
  An Experiment is a long-lived effort within a Study (e.g., "Validate Assay"). It captures intent (claims), scope, and lightweight management metadata. It does NOT embed assertions, evidence, runs, or event logs. Those are standalone records: Runs reference experimentId; meaning is bound to Claims/Assertions/EvidenceBundles.

type: object
unevaluatedProperties: false
allOf:
- $ref: "./common.schema.yaml#/$defs/FAIRCommon"

required:
- kind
- recordId
- title
- shortSlug
- studyId

properties:
  kind:
    const: "experiment"
    description: "Record discriminator."

  recordId:
    type: string
    description: "Stable local identifier (e.g., EXP-000123)."

  title:
    type: string
    description: "Human-readable experiment title."

  shortSlug:
    type: string
    description: "URL-safe short identifier for the experiment."

  studyId:
    type: string
    description: "Parent Study recordId."

  state:
    type: string
    description: "Workflow state (draft, in_progress, accepted, rejected, superseded, archived)."

  description:
    type: string
    description: "Optional summary of the experiment scope and goals."

  tags:
    type: array
    items: { type: string }
    uniqueItems: true

  # Intent anchors: references only (claims hold meaning + evidence)
  claimIds:
    type: array
    description: >
      Claims this experiment intends to test/explore. Claims remain the authoritative locus of meaning, evidence bundles, and assertions.
    items:
      type: string
    uniqueItems: true

  # Optional pointer to curated narrative spine (separate record, avoids schema bloat)
  narrativeId:
    type: string
    description: "Optional recordId of an experiment-narrative record."

  # Optional scoped context (lightweight; not canonical provenance)
  context:
    type: object
    description: >
      Optional lightweight descriptors for search/navigation. This is not a substitute for event provenance and must not be treated as authoritative state.
    additionalProperties: false
    properties:
      measurementType:
        type: string
      technologyType:
        type: string
      factors:
        type: array
        items:
          $ref: "#/$defs/Factor"
        uniqueItems: true
      materials:
        type: array
        description: "Optional material refs relevant to the experiment (convenience only)."
        items: { type: string }
        uniqueItems: true
      instruments:
        type: array
        description: "Optional instrument identifiers (convenience only)."
        items: { type: string }
        uniqueItems: true

  attachments:
    type: array
    description: "Optional experiment-level attachments (plans, reports, figures)."
    items: { type: string }

$defs:
  Factor:
    type: object
    additionalProperties: false
    required: [ factorName, factorValue ]
    properties:
      factorName:
        type: string
      factorValue:
        type: string
